<kor-modal id="form7" label="About this application" height="80%" width="60%" style="font-size: large;">
    <kor-tabs id="hlp-tabs" slot="header" style="width: fit-content;">
        <kor-tab-item id="hlp-item-0" label="Squiggly Math" active></kor-tab-item>
        <kor-tab-item id="hlp-item-1" label="Special Thanks"></kor-tab-item>
        <kor-tab-item id="hlp-item-2" label="Software Components"></kor-tab-item>
        <kor-tab-item id="hlp-item-3" label="Legal Disclaimer"></kor-tab-item>
    </kor-tabs>
    <kor-card id="hlp-tab-0" flex-direction="column" flat style="overflow: inherit;">
        <kor-text size="body-1">
            These are the equations used in this software. The list goes through the calculation steps, and explains how certain values should be entered in the input fields.
        </kor-text>
        <kor-text size="header-1"><kor-icon icon="visibility"></kor-icon>Sight reduction</kor-text>
        <kor-text size="body-1">
            <b>H<sub>s</sub></b>: sextant altitude<br />
            The input field for this value is divided into degrees, arc minutes and arc seconds, but also accepts decimal values for every field.<br />
            Any non-numeric character can be used as separator. For example the string entered as <b>45d 12.3m</b> will be reformatted to <b>45&deg; 12.3' 00"</b>, and it will be converted to decimal degrees internally.<br />
            <b>IE</b>: Index error OFF the arc<br />
            The value entered will be added to the sextant altitude. If the error is ON the arc, a negative value should be entered.<br />
            <b>r</b>: radius of Earth in meters<br />
            <b>h</b>: observer height in meters<br />
            <b>p</b>: pressure in millibar<br />
            <b>T</b>: temperature in Celsius<br />
            <b>Dip</b>: dip correction<br />
            The method of measurement should also be selected, since it effects dip correction.<br />
            Measurements taken with a sextant will be corrected for horizon dip.<br />
            Measurements taken with an artificial horizon will be divided by 2 and no dip correction will be applied.<br />
            Measurements taken with a cellphone will not be corrected for dip since the cellphone measures the angle against the tangential plane to the local gravity vector.<br />
            Measurements taken with a theodolite will not be corrected for dip, but because surveyors measure angles from the zenith, the measured angle will be subtracted from 90&deg;.<br />
            <script type="math/tex; mode=display">Dip~[ \degree ] = arc~cos \left( {\left( 1 + \frac{h}{1.2 \cdot r}  \right)} ^{-1} \right)</script><br />
            <b>H<sub>a</sub></b>: apparent altitude<br />
            for horizon measurements:<br />
            <script type="math/tex; mode=display">H_a = H_s + IE - Dip</script><br />
            for artificial horizon measurements:<br />
            <script type="math/tex; mode=display">H_a = \frac{H_s + IE}{2}</script><br />
            <b>f</b>: Refraction coefficient
            <script type="math/tex; mode=display">f = \frac{ p }{ 1010} \cdot \frac{283.15}{273.15 + T}</script><br />
            <b>R<sub>0</sub></b>: standard refraction at 1010 mbar and 10 &deg;C<br />
            <script type="math/tex; mode=display">R_0~['] = { \left( tan \left( H_a + \frac{7.31}{H_a + 4.4} \right) \right) }^{-1}</script><br />
            <b>R</b>: refraction
            <script type="math/tex; mode=display">R~[ \degree ] = f \cdot R_0 \cdot 60</script><br />
            <b>H<sub>r</sub></b>: altitude corrected for refraction<br />
            <script type="math/tex; mode=display">H_r = H_a - R</script><br />
            <b>SD</b>: semidiameter (added for lower limb sights and subtracted for upper limb sights)<br />
            <b>H<sub>d</sub></b>: altitude corrected for semidiameter<br />
            <script type="math/tex; mode=display">H_d = H_r \pm SD</script><br />
            <b>HP</b>: parallax coefficient for Mars, Venus, Moon or Sun<br />
            <b>P</b>: parallax<br />
            <script type="math/tex; mode=display">P = HP \cdot cos(H_d)</script><br />
            <b>H<sub>o</sub></b>: observed (true) altitude<br />
            <script type="math/tex; mode=display">H_o = H_D + P</script><br />
        </kor-text>
        <kor-text size="header-1"><kor-icon icon="watch"></kor-icon>Date and time</kor-text>
        <kor-text size="body-1">
            <b>D</b>: date in local time zone<br />
            <b>WT</b>: watch time in local time zone<br />
            <b>z</b>: time zone difference in hours<br />
            Eastern timezones are represented as GMT+z, the z value will be subtracted<br />
            Western timezones are represented as GMT-z, the z value will be added<br />
            If observations are taken around midnight, 24 can be entered in the <i>hours</i> field if an observation falls on the start of the next day. The UTC date will be automatically corrected internally.
            <b>WE</b>: watch error in seconds<br />
            positive if watch is behind current time<br />
            negative if watch is ahead current time<br />
            <b>UT</b>: date and time in UTC timezone (a.k.a. GMT+0)
            <script type="math/tex; mode=display">UT = D + WT - z + WE</script>
        </kor-text>
        <kor-text size="header-1"><kor-icon icon=""></kor-icon>Geographic positions</kor-text>
        <kor-text size="body-1">
            <b>GHA<sub>H</sub></b>: Greenwich hour angle of the observed body at the whole hour<br />
            <b>GHA<sub>Aries</sub></b>: Greenwich hour angle of the celestial meridian at the whole hour<br />
            <b>GHA<sub>i</sub></b>: increment of GHA for the minutes and seconds of observation, depends on the ovserved body<br />
            <b>SHA</b>: Sidereal hour angle of a star (not applicable for the Sun, Moon and planets)<br />
            <b>v</b>: coefficient for velocity from the daily pages<br />
            <b>v correction</b>: “The change in hour angle arising from velocity of the body at the time of the sight observation is accounted
            for with the v correction.” Source- <a href="https://thenauticalalmanac.com/2019_Bowditch-_American_Practical_Navigator.html" target="_blank" rel="noopener noreferrer">Bowditch 2017</a>, Chapter 19- Sight Reduction p. 313. The planet’s v is positive
            unless preceeded by a minus sign which is sometimes the case with Venus. The sign of the Moon’s v is positive.<br />
            The correction values are calculated with the following formula:<br />
            <script type="math/tex; mode=display">v_{corr}~[\degree] = v \cdot (UT_{minutes} + 0.5)</script>
            corrected GHA for the Sun:<br />
            <script type="math/tex; mode=display">GHA = GHA_H + GHA_i</script>
            corrected GHA for the Moon and planets:<br />
            <script type="math/tex; mode=display">GHA = GHA_H + GHA_i + v_{corr}</script>
            corrected GHA for the stars:<br />
            <script type="math/tex; mode=display">GHA = GHA_{Aries} + GHA_i + SHA</script>
            <b>DEC</b>: Declination measured from the celestial equator<br />
            <b>d</b>: coefficient for declination from the daily pages (not applicable for stars)<br />
            <b>d correction</b>: “The change in declination of the body at the time of the sight observation is accounted for with the d
            correction.” Source- <a href="https://thenauticalalmanac.com/2019_Bowditch-_American_Practical_Navigator.html" target="_blank" rel="noopener noreferrer"></a>Bowditch 2017</a>, Chapter 19- Sight Reduction p. 313. The sign of the Moon or planet’s d
            correction is determined by the declination trend- positive if successive declination values increase and negative if they decrease.<br />
            The correction values are calculated with the following formula:<br />
            <script type="math/tex; mode=display">d_{corr}~[\degree] = d \cdot (UT_{minutes} + 0.5)</script>
            <b>DEC<sub>corrected</sub></b>:
            <script type="math/tex; mode=display">DEC_{corr} = DEC + d_{corr}</script>
            <b>GP</b>: Geographic position on Earth where the observed body is directly at the zenith<br />
            Declination corresponds to latitude on Earth.<br />
            GHA corresponds to longitude, but GHA is measured from the celestial meridian (Constellation of Aries) towards west in the [0&deg;, 360&deg;] interval, while
            latitude is measured from the Greenwich meridian towards East, in the [-180&deg;, 180&deg;] interval.<br />
            In the measurements form the geographic position of a landmark can also be added, with the estimated distance from this landmark.<br />
            The distance will be converted to an altitude angle to draw a circle. Only the intersection points falling inside this circle will be used to calculate the location fix. Useful if there is only two star sights to work with.<br />
            <script type="math/tex; mode=display">H_a = 90\degree - \frac{distance}{r_{Earth}}</script>
        </kor-text>
        <kor-text size="header-1"><kor-icon icon=""></kor-icon>Location fix</kor-text>
        <kor-text size="body-1">
            Once the geographic position of a celestial body and the altitude angle is calculated, circles of equal altitude can be drawn on the surface of the Earth.<br />
            These circles are the locations from where each observer sees a certain celestial body at the same angle.<br />
            For each pair of circles, the coordinates of the intersection point are determined, using <a href="https://sites.google.com/site/navigationalalgorithms/Home/papersnavigation" target="_blank" rel="noopener noreferrer">A. González's method.</a><br />
            The GP vectors are projected to a unit sphere, and the spherical coordinates are converted to cartesian coordinates.<br />
            <script type="math/tex; mode=display">\begin{bmatrix} x \\ y \\ z \end{bmatrix} = \begin{bmatrix} cos(lat) \cdot cos(lon) \\ cos(lat) \cdot sin(lon) \\ sin(lat) \end{bmatrix}</script>
            This same formula can be use to convert celestial coordinates too, with the substitution of <i>lat = declination</i> and <i>lon = -GHA</i>.<br />
            The cosine of the angle between two GP vectors can be computed with the dot product, utilising the fact that the vectors are both one unit long.<br />
            <script type="math/tex; mode=display">cos~\alpha = \overrightharpoon{GP_1} \bullet \overrightharpoon{GP_2}</script>
            A trigonometric identity gives the squared sine of the angle, which will be used in later formulas.<br />
            <script type="math/tex; mode=display">sin^2~\alpha = 1 - cos^2~\alpha</script>
            The central point of the intersection of two circles can be calculated with the following formula:<br />
            <script type="math/tex; mode=display">k_1 = \frac{sin(H_{o1}) - sin(H_{o2}) cos~\alpha} {sin^2~\alpha}</script>
            <script type="math/tex; mode=display">k_2 = \frac{sin(H_{o2}) - sin(H_{o1}) cos~\alpha} {sin^2~\alpha}</script>
            <script type="math/tex; mode=display">\overrightharpoon{C} = k_1~ \overrightharpoon{GP_1} + k_2~ \overrightharpoon{GP_2}</script>
            The cross product of the two GP vectors gives a direction pointing towards one of the intersection points. This will be scaled down to unit length in the last formula.<br />
            <script type="math/tex; mode=display">\overrightharpoon{X} = \overrightharpoon{GP_1} \times \overrightharpoon{GP_2}</script>
            Using the direction vector and its inverse, the two intersection points can be obtained.<br />
            <script type="math/tex; mode=display">\overrightharpoon{IP_{1,2}} = \overrightharpoon{C} \pm \overrightharpoon{X} \sqrt{\frac{1 - \overrightharpoon{C} \bullet \overrightharpoon{C}}{ \overrightharpoon{X} \bullet \overrightharpoon{X}}}</script>
            <br />
            Next, for each pair of intersection points, their distance is computed using the Haversine formula.<br />
            The "crooked hat" is formed with the three points that are closest to eachother, within the distance of a landmark if it's given.<br />
            The average of these three points gives the approximate location fix. This is a rather imprecise approximation, so don't rely on this, or don't get surprised when you're lost at sea and sharks bite your arse off.<br />
        </kor-text>
    </kor-card>
    <kor-card id="hlp-tab-1" flex-direction="column" flat style="display:none; overflow: inherit;">
        <kor-text size="header-1">Special thanks to the following individuals:</kor-text>
        <ul>
            <li><b>MCToon</b> - for creating the celestial navigation challenges</li>
            <li><b>FTFE</b> and <b>Roohif</b> - for demonstrating how it works on a globe</li>
            <li><b>Bacon</b> for giving inspiration by winning the $100 challenge with his own navigation software</li>
            <li><b>Tiny Captain</b> and <b>Proto Thad</b> - for giving me advice on celestial navigation</li>
            <li>All the <b>Flerfs</b> who aggravated me so I started to write this software</li>
        </ul>
    </kor-card>
    <kor-card id="hlp-tab-2" flex-direction="column" flat style="display:none; overflow: inherit;">
        <a href="https://github.com/jtakacs/astronavigation" target="_blank" rel="noopener noreferrer">GitHub Repo</a>
        <kor-text size="header-1">Libraries used in this software</kor-text>
        <a href="https://rhodesmill.org/skyfield/" target="_blank" rel="noopener noreferrer">skyfield</a>
        <a href="https://github.com/aendie/SFalmanac-Py3" target="_blank" rel="noopener noreferrer">SFalmanac-Py3</a>
        <a href="https://pyscript.net/" target="_blank" rel="noopener noreferrer">pyscript</a>
        <a href="https://opencpn.org/wiki/dokuwiki/lib/exe/fetch.php?media=opencpn:plugins:celestial_navigation:vector2cop.pdf" target="_blank" rel="noopener noreferrer">opencpn - vector2cop plugin</a>
        <a href="https://threejs.org/" target="_blank" rel="noopener noreferrer">THREE.js</a>
        <a href="https://kor-ui.com/" target="_blank" rel="noopener noreferrer">kor-ui</a>
        <a href="https://lit.dev/" target="_blank" rel="noopener noreferrer">lit</a>
        <a href="https://katex.org/" target="_blank" rel="noopener noreferrer">katex</a>
        <a href="https://nearley.js.org/docs/index" target="_blank" rel="noopener noreferrer">nearley.js</a>
    </kor-card>
    <kor-card id="hlp-tab-3" flex-direction="column" flat style="display:none; overflow: inherit;">
        <kor-text size="header-1">
            This program is free software: you can redistribute it and/or modify
            it under the terms of the GNU General Public License as published by
            the Free Software Foundation, either version 3 of the License, or
            (at your option) any later version.
        </kor-text>
        <kor-text size="header-1">
            This program is distributed in the hope that it will be useful,
            but WITHOUT ANY WARRANTY; without even the implied warranty of
            MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
            GNU General Public License for more details.
        </kor-text>
        <kor-text size="header-1">
            THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS
            OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
            AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
            CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
            DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; INJURY OR LOSS OF LIFE;
            LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
            LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
            ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
        </kor-text>
    </kor-card>
</kor-modal>